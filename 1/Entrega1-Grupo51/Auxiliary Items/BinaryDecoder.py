import sys
import argparse


def get_binary(data: str, group_size: int = 8) -> str:
    res = []
    for i, c in enumerate(data):
        if i % group_size == 0 and i != 0:
            res.append(" ")
        res.append("0" if c == "." else "1")
    return "".join(res)


def binary_to_text(binary_string: str, group_size: int = 8, pad: bool = True) -> str:
    text = []
    for b in binary_string.split():
        if len(b) < group_size:
            if pad:
                b = b.ljust(group_size, "0")
            else:
                continue
        text.append(chr(int(b, 2)))
    return "".join(text)


def main(image, debug=False):
    if image == "barragemFagilde":
        data = "..--...-..--.-.-..--.-.-.--..-....--...-..--.-.-..--.-......-.-...----....-.......-.......-.......-...--..-......--....-.--..-...---.--..--....-.--.---..--...--.--..-.-.--..-....-......---..-..---.-.-.--.--...--..-.-..-.......--...-....-.-...----....-.......-.......-......---.-...--..-.-.---..--.---.-...--..-.-.---..-..-.-----.---.....--.--...--....-.---.-...--..-.-.---..--..-.......----.-..-......--.--...--.----.--....-.--..-...-.-----.---.-...--..-.-.---..--.---.-...--..-.-.---..-..-.-----.---.....--.--...--....-.---.-...--..-.-.---..--.-.-----.--..--..---..-..--.----.--.--.-.-.-----.--..-...--...-...-.-.....-.-..-....-.-...----....-.......-.......-......--.-..-.--..--...-......--...--.---.-.-.---..-..---..-..--..-.-.--.---..---.-...-.-----.---.-...---..-..--....-.--.---..---..--.--....-.--...--.---.-...--.-..-.--.----.--.---...-.---..---.....--.--...--....-.---.-...--..-.-..-......--.-..-.--.---...-......---.-...--..-.-.---..--.---.-...--..-.-.---..-..-.-----.---.....--.--...--....-.---.-...--..-.-.---..--..---.-.....-.-...----....-.......-.......-.......-.......-.......-.......-......--...--.---.-.-.---..-..---..-..--..-.-.--.---..---.-...-.-----.---.-...---..-..--....-.--.---..---..--.--....-.--...--.---.-...--.-..-.--.----.--.---...-.---..---.....---..-..--.-..-.--...--.--..-.-..-.......----.-..-.......--......-.---...--......-.......-.......-.......-...--..-......--...--.--.----.--.--.-.---.....---.-.-.---.-...--..-.-.-.-----.--..-...----..-.--.---..--....-.--.--.-.--.-..-.--...--.-.-----.---.....---..-..--.-..-.--...--.--..-.-..-.-....--...--.---.-.-.---..-..---..-..--..-.-.--.---..---.-...-.-----.---.-...---..-..--....-.--.---..---..--.--....-.--...--.---.-...--.-..-.--.----.--.---...-.-..-....-.-...----....-.......-.......-.........-.-...----....-.......-.......-.......-...--..-......--....-.--..-...---.--..--....-.--.---..--...--.--..-.-.--..-....-......---..-..---.-.-.--.--...--..-.-..-.......--..-.....-.-...----....-.......-.......-......--.-..-.--..--...-.......-.-....--...--.---.-.-.---..-..---..-..--..-.-.--.---..---.-...-.-----.---.-...---..-..--....-.--.---..---..--.--....-.--...--.---.-...--.-..-.--.----.--.---...-.---..---.....--.--...--."
        offset = 0
    elif image == "barragemOdelouca":
        data = "...-.---.-...--..-.-.-.-----.--...--.--.----.---.-.-.--.---..---.-...---..-..----..-..-.......-....-..----.-..-.......-...-..-.-.....-.-.-....-...-...-......--.----.---..-...-......--.-..-.---..--.-.-----.---.....--.--...--....-.---.-...--..-.-.-.-----.--..--..---..-..--.----.--.--.-.-.-----.---..-..--..-.-.--.---..---.-...--....-.--.--...-.-----.--...--.--.----.--.--.-.---.....--....-.--.---..----..-..-.-....--...--.---.-.-.---..-..---..-..--..-.-.--.---..---.-...-.-----.---.-...---..-..--....-.--.---..---..--.--....-.--...--.---.-...--.-..-.--.----.--.---...-.---..---.....--.--...--....-.---.-...--..-.-..-.-..-..-.-..-..-......--....-.--.---..--..-....-......---..-..--....-.--.---..--..-...--.----.--.--.-..-.---..---..-..--....-.--.---..--..-...--.----.--.--.-..-.-.....-.-..-..-.......----....-.......--......-.---...--.-.-..---.-.....-.-...----....-.......-.......-.......-.......-.......-.......-......--...--.---.-.-.---..-..---..-..--..-.-.--.---..---.-...-.-----.---.-...---..-..--....-.--.---..---..--.--....-.--...--.---.-...--.-..-.--.----.--.---...-.---..--.--...--.-..-.--...--.--..-.-.--.---..---..--.--.----.---..-..-.-----.--.-..-.--..-....-.......----.-..-.......--..-...--...-..--.---....-.-...----....-.......-.......-.......-.......-.......-.......-......--...--.---.-.-.---..-..---..-..--..-.-.--.---..---.-...-.-----.---.-...---..-..--....-.--.---..---..--.--....-.--...--.---.-...--.-..-.--.----.--.---...-.---..---.....---..-..--.-..-.--...--.--..-.-..-.......----.-..-......---..-..--.----.---.-.-.--.---..--..-....-.-....--...--.--.----.--.--.-.---.....---.-.-.---.-...--..-.-.-.-----.--..-...----..-.--.---..--....-.--.--.-.--.-..-.--...--.-.-----.---.....---..-..--.-..-.--...--.--..-.-..-.-....--...--.---.-.-.---..-..---..-..--..-.-.--.---..---.-...-.-----.---.-...---..-..--....-.--.---..---..--.--....-.--...--.---.-...--.-..-.--.----.--.---...-.-..-..-.......-.-.-...-......---..-..--....-.--.---..--..-...--.----.--.--.-..-.---..---.-.-.--.---..--.-..-.--..--..--.----.---..-..--.--.-..-.-.....--...-..-.---...--.-.-..-.--....-.......--..-...-.-..-..-.--....-.......--..-...-.-..-....-.-...----....-.......-.......-.......-.........-.-...-----...-....."
        offset = 4
    else:
        print("Image not found")
        sys.exit(1)

    if debug:
        print("Data before offset:\n", data, "\n")
    data = data[offset:]
    if debug:
        print(f"Data after offset (= {offset}):\n", data, "\n")

    # group_sizes = list(range(1, 17))
    group_sizes = [8]
    for group_size in group_sizes:
        binary = get_binary(data, group_size)
        if debug:
            print(f"\nBinary (size {group_size}):\n", binary, "\n")
        text = binary_to_text(binary, group_size)
        print(f"\nText (size {group_size}):\n", text)


if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="Decode encoded image data.")
    parser.add_argument("image", help="Image name (e.g., barragemOdelouca)")
    parser.add_argument("--debug", action="store_true", help="Enable debug output")

    args = parser.parse_args()
    main(args.image, args.debug)
